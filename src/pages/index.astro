---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';

const posts = (await getCollection('blog', ({ data }) => {
	return data.draft !== true;
})).sort(
	(a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

const getSlug = (post: any) => {
    return post.slug || post.id.replace(/\.md$/, '');
};
---

<Layout title="Lei Blog">
	<ul class="post-list">
		{
			posts.map((post) => (
				<li class="post-item">
					<a href={`/posts/${getSlug(post)}/`} class="post-link">
						<span class="post-title">{post.data.title}</span>
					</a>
					<time datetime={post.data.date.toISOString()} class="post-date">
						{post.data.date.toLocaleDateString('en-us', {
							year: 'numeric',
							month: 'short',
							day: 'numeric',
						})}
					</time>
				</li>
			))
		}
	</ul>
</Layout>

<style>
	.post-list {
		list-style-type: none;
		padding: 0;
	}
	.post-item {
		display: flex;
		justify-content: space-between;
        align-items: baseline;
		margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
	}
    .post-link {
        font-size: 1.2rem;
        font-weight: 500;
        color: var(--text-color);
    }
    .post-link:hover {
        color: var(--primary-color);
    }
	.post-date {
		font-size: 0.9rem;
		color: var(--text-secondary);
        white-space: nowrap;
        margin-left: 1rem;
	}

    @media (max-width: 600px) {
        .post-item {
            flex-direction: column;
            align-items: flex-start;
        }
        .post-date {
            margin-left: 0;
            margin-top: 0.25rem;
        }
    }
</style>
